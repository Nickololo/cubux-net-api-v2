Контекст данных
===============

См. также Контексты:

*   [Публичные данные](context/global.md)
*   [Личные данные текущего пользователя](context/user.md)
*   [Данные конкретной команды](context/team.md)

Данные контекста представлены объектом типа [`Cubux.Sync.Data`][Cubux.Sync.Data]. Данные
имеют номер версии.

### Поля Контекста

Полезные данные различных типов (например, счета, категории, транзакци)
представлены в Контексте в виде отдельных полей. Каждое такое поле в
зависимости от рода данных может быть либо массивом записей, либо отдельной
записью.

### Идентификация записей

Каждая запись идентифицируется уникальным ключом (PK). Ключ может быть как
простым auto increment (PK AI), так и составным.


Изменение данных
----------------

См. [`Cubux.Sync.DataWriteable`][Cubux.Sync.DataWriteable].

### Создание новых записей

Все новые записи, созданные на клиенте, при первой отправке на сервер
обязательно помечаются локальным идентификатором. Для этого в запись
добавляется поле `_local_id` с произвольной строкой. Только наличие этого
поля означает создание записи.

Успешно созданые записи в ответе будут помечены соответствующим локальным
идентификатором. При этом записи с PK AI уже будут иметь конкретные
значения в ключах, поэтому клиент может и должен сохранить соответствие
PK AI с локальными идентификаторами. После этого локальный идентификатор
больше не нужен серверу, и не должен передаваться при обновлении и удалении
записей.

В случае ошибок локальный идентификатор указывается в
соответствующей информации об ошибках ([`Cubux.Sync.Error`][Cubux.Sync.Error]).

Локальные идентификаторы могут использоваться в том же запросе в других
записях, где необходимо сослаться на создаваемую запись. Для этого в
ведомых записях используются отдельные поля (см описание соответствующего
типа).

### Обновление записей

При обновлении записей необходимо указывать идентификатор записи и поля,
значения которых необходимо изменить. Все отправленые поля будут изменены
на указаные значения независимо от прошлых сеансов синхронизации.

### Удаление записей

Для удаления записей необходимо указывать идентификатор записи и маркер
удаления: поле `is_deleted` = boolean `true`.


[Cubux.Sync.Data]: ../type/sync-data.md
[Cubux.Sync.DataWriteable]: ../type/sync-data-writeable.md
[Cubux.Sync.Error]: ../type/sync-error.md
